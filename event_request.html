<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Event Request - Student</title>
    <!-- Link to your existing CSS -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h2>Event Request Form</h2>
        <form id="eventForm">
            <label>Student Name:</label>
            <input type="text" id="name" required>

            <label>Roll Number:</label>
            <input type="text" id="roll" required>

            <label>Event Title:</label>
            <input type="text" id="title" required>

            <label>Event Date:</label>
            <input type="date" id="date" required>

            <label>Location:</label>
            <input type="text" id="location" required>

            <label>Description:</label>
            <textarea id="description" rows="4" required></textarea>

            <button type="submit">Submit Event Request</button>
            <p class="message" id="message"></p>
        </form>

        <h2>Check Your Event Requests</h2>
        <form onsubmit="event.preventDefault(); fetchEvents();">
            <label>Enter Roll Number:</label>
            <input type="text" id="searchRoll" required>
            <button type="submit">View My Events</button>
        </form>

        <div class="card" id="eventStatus"></div>
    </div>

    <script>
        const BASE_URL = "http://127.0.0.1:8000";

        document.getElementById("eventForm").addEventListener("submit", function (e) {
            e.preventDefault();

            const roll = document.getElementById("roll").value;
            const title = document.getElementById("title").value;
            const date = document.getElementById("date").value;
            const location = document.getElementById("location").value;
            const description = document.getElementById("description").value;

            const body = `roll=${encodeURIComponent(roll)}&title=${encodeURIComponent(title)}&date=${encodeURIComponent(date)}&location=${encodeURIComponent(location)}&description=${encodeURIComponent(description)}`;

            fetch(`${BASE_URL}/submit_event`, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: body
            })
            .then(res => res.json())
            .then(data => {
                document.getElementById("message").textContent = data.message || data.error;
                document.getElementById("eventForm").reset();
            })
            .catch(err => alert("Submission failed: " + err.message));
        });

        function fetchEvents() {
            const roll = document.getElementById("searchRoll").value;

            fetch(`${BASE_URL}/view_events_by_roll`, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `roll=${encodeURIComponent(roll)}`
            })
            .then(res => res.json())
            .then(events => {
                let html = `<h3>Your Event Requests:</h3>`;
                if (!Array.isArray(events) || events.length === 0) {
                    html += "<p>No event requests found.</p>";
                } else {
                    html += `<ul>`;
                    events.forEach(event => {
                        html += `<li class="card">
                                    <strong>${event.title}</strong> (${event.date}) at ${event.location}<br>
                                    Status: <strong>${event.status}</strong><br>
                                    Response: ${event.response || "No response yet"}
                                </li>`;
                    });
                    html += `</ul>`;
                }
                document.getElementById("eventStatus").innerHTML = html;
            })
            .catch(err => {
                document.getElementById("eventStatus").innerText = "Error fetching events: " + err.message;
            });
        }
    </script>
</body>
</html>
