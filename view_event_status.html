<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Event Status</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
            background-color: #f5f5f5;
        }
        h2 {
            color: #2c3e50;
        }
        form {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        input, button {
            padding: 10px;
            font-size: 16px;
            margin: 8px 0;
            width: 100%;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #2980b9;
        }
        .status {
            background: #fff;
            padding: 20px;
            border-radius: 6px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .event-block {
            margin-bottom: 20px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 15px;
        }
    </style>
</head>
<body>

    <h2>Check Your Event Request Status</h2>

    <form onsubmit="event.preventDefault(); fetchEventStatus();">
        <label for="roll">Enter Your Roll Number:</label>
        <input type="text" id="roll" required>
        <button type="submit">Check Status</button>
    </form>

    <div class="status" id="eventStatusBox">
        <!-- Results will be displayed here -->
    </div>

    <script>
        const BASE_URL = "http://127.0.0.1:8000";

        function fetchEventStatus() {
            const roll = document.getElementById("roll").value;

            fetch(`${BASE_URL}/view_events_by_roll`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: `roll=${encodeURIComponent(roll)}`
            })
            .then(res => res.json())
            .then(data => {
                const statusBox = document.getElementById("eventStatusBox");

                if (data.error) {
                    statusBox.innerHTML = `<p style="color:red;">${data.error}</p>`;
                    return;
                }

                if (data.length === 0) {
                    statusBox.innerHTML = "<p>No event requests found for this roll number.</p>";
                    return;
                }

                let html = "<h3>Your Event Requests:</h3>";
                data.forEach(event => {
                    html += `
                        <div class="event-block">
                            <strong>Title:</strong> ${event.title}<br>
                            <strong>Date:</strong> ${event.date}<br>
                            <strong>Location:</strong> ${event.location}<br>
                            <strong>Description:</strong> ${event.description}<br>
                            <strong>Status:</strong> ${event.status}<br>
                            <strong>Principal Response:</strong> ${event.response || "No response yet"}
                        </div>
                    `;
                });

                statusBox.innerHTML = html;
            })
            .catch(err => {
                document.getElementById("eventStatusBox").innerHTML = `<p style="color:red;">Failed to load status. Try again later.</p>`;
            });
        }
    </script>

</body>
</html>
